<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –†–ó–°</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: sans-serif; background: #f5f7fa; margin: 0; padding: 15px; }
        .camp { background: #fff; padding: 15px; border-radius: 15px; margin-bottom: 10px; border-left: 5px solid #1A237E; }
        .btn { width: 100%; padding: 12px; background: #1A237E; color: #fff; border: none; border-radius: 10px; font-weight: 700; margin-top: 10px; }
    </style>
</head>
<body>
    <h2 style="color:#1A237E">–ú–û–ò –ö–ê–ú–ü–ê–ù–ò–ò</h2>
    <div id="list">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    <button class="btn" style="background:#78909C" onclick="location.href='index.html'">–ù–ê –ì–õ–ê–í–ù–£–Æ</button>

    <script>
        let tg = window.Telegram.WebApp;
        let uid = tg.initDataUnsafe?.user?.id || 123;

        fetch('/api/user-campaigns/' + uid).then(r => r.json()).then(d => {
            let html = '';
            d.campaigns.forEach(c => {
                html += `
                    <div class="camp">
                        <b>#${c.campaign_number}</b><br>
                        –°—Ç–∞—Ä—Ç: ${c.start_date}<br>
                        –°—É–º–º–∞: ${c.final_price} ‚ÇΩ | –û—Ö–≤–∞—Ç: ${c.actual_reach} —á–µ–ª.<br>
                        <button class="btn" style="background:#2E7D32" onclick="sendExcel('${c.campaign_number}')">üìä EXCEL –í TELEGRAM</button>
                    </div>
                `;
            });
            document.getElementById('list').innerHTML = html || '–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–∫–∞–∑–æ–≤.';
        });

        function sendExcel(num) {
            fetch('/api/send-excel/' + num, {
                method: 'POST', headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({user_telegram_id: uid})
            }).then(() => alert('Excel –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ –≤–∞—à —á–∞—Ç —Å –±–æ—Ç–æ–º!'));
        }
    </script>
</body>
</html>
